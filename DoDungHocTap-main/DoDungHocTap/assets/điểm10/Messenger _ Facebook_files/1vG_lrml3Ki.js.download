;/*FB_PKG_DELIM*/

__d("LSLocalCreateOptimisticGroupThreadStoredProcedure",["LSLocalCreateOptimisticGroupThread"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.participants;d[1]=b.nullstateDescriptionText;d[2]=b.checkExistingThreads;return c("LSLocalCreateOptimisticGroupThread").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSUpdateMessageSearchQueryStatus",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(70).put({query:a[0],type_:a[1],threadKeyV2:a[5]==null?b.i64.cast([0,0]):a[5],status:a[2],hasNextPage:a[3],nextPageCursor:a[4],resultCount:a[6]})},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("MAWCreateOptimisticSecureThread",["I64","LSAuthorityLevel","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSVerifyE2EEMetadataThreadExistsV2StoredProcedure","Promise","ReQLTable","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,b){return c("LSVerifyE2EEMetadataThreadExistsV2StoredProcedure")(c("LSFactory")(a),{authorityLevel:(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),threadType:b}).then(function(b){var e=b[0];return d("ReQLTable").update(a.table("threads"),[e],function(a){if(a==null)throw c("unrecoverableViolation")("Optimistic thread is missing","messenger_e2ee_web");return babelHelpers["extends"]({},a,{clientThreadKey:e})}).then(function(){return e})})}function a(a,e,f){return k(a,f).then(function(f){return(h||(h=b("Promise"))).all(e.map(function(b){return a.table("participants").add({authorityLevel:(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),contactId:b.id,deliveredWatermarkTimestampMs:(i||(i=d("I64"))).zero,groupParticipantJoinState:j.ofNumber(c("LSGroupParticipantJoinState").MEMBER),isAdmin:void 0,isModerator:!1,isSuperAdmin:void 0,nickname:void 0,normalizedSearchTerms:void 0,participantCapabilities:void 0,readActionTimestampMs:i.zero,readWatermarkTimestampMs:i.zero,subscribeSource:void 0,threadKey:f})})).then(function(){return f})})}g.call=a}),98);
__d("MWPThreadPreview.react",["CometHeroInteractionWithDiv.react","I64","Int64Hooks","InteractionTracingMetrics","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSIntEnum","LSLocalCreateOptimisticGroupThreadStoredProcedure","LSMessagingThreadTypeUtil","LSVec","LSVerifyContactRowExistsStoredProcedure","LSVerifyThreadRowExistsStoredProcedure","MWChatInteraction","MWPActor.react","MWPThreadThemeProvider.react","MWThreadKey.react","MWXSpinner.react","Promise","ReQL","ReQLSuspense","cr:7001","gkx","promiseDone","react","recoverableViolation","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=l||(l=d("react"));e=l;var n=e.useEffect,o=e.useMemo,p=c("gkx")("7935"),q={composer:{flexShrink:"x2lah0s",minHeight:"x879a55",$$css:!0},container:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",fontSize:"x6prxxf",minHeight:"x2lwn1j",$$css:!0},preview:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",minHeight:"x2lwn1j",$$css:!0},spinner:{alignItems:"x6s0dn4",display:"x78zum5",flexGrow:"x1iyjqo2",justifyContent:"xl56j7k",$$css:!0}};function r(a){var e=(k||(k=c("useReStore")))();n(function(){c("promiseDone")(e.runInTransaction(function(e){return(h||(h=b("Promise"))).all(a.map(function(a){return c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(e),{authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").CLIENT_PARTIAL),blockedByViewerStatus:i.ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:i.ofNumber(c("LSContactIdType").FBID),contactType:i.ofNumber(c("LSContactType").USER),contactViewerRelationship:i.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:i.ofNumber(c("LSContactGender").UNKNOWN),id:a.id,isBlocked:!1,isMemorialized:!1,isSelf:!1,workForeignEntityType:i.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)})}))},"readwrite"))},[e,JSON.stringify(a.map(function(a){return(j||(j=d("I64"))).to_string(a.id)}))])}function s(a){var b=a.children,e=a.renderThreadPreview,f=a.renderThreadView,g=a.thread,h=d("MWChatInteraction").get("open_with_tokens");n(function(){h!=null&&(c("InteractionTracingMetrics").addAnnotation(h,"thread_id",(j||(j=d("I64"))).to_string(g.threadKey)),c("InteractionTracingMetrics").addAnnotation(h,"thread_type",j.to_string(g.threadType)),c("InteractionTracingMetrics").addAnnotation(h,"isSecure",d("LSMessagingThreadTypeUtil").isSecure(g.threadType).toString()))},[h,g.threadKey,g.threadType]);return e!=null?e(g,b):m.jsx(d("MWThreadKey.react").MWThreadKeyProvider,{id:g.threadKey,children:m.jsxs("div",{className:"x78zum5 xdt5ytf x1iyjqo2 x6prxxf x2lwn1j",children:[m.jsx(c("CometHeroInteractionWithDiv.react"),{interactionDesc:"MWV2_CHAT_TAB",interactionUUID:h,pageletName:"ChatTab",xstyle:q.preview,children:m.jsx(c("MWPThreadThemeProvider.react"),{themeFbid:g.themeFbid,children:f(g)})}),m.jsx("div",{className:"x2lah0s x879a55",children:b})]})})}s.displayName=s.name+" [from "+f.id+"]";function t(a){var b=a.children,e=a.recipientToken,g=a.renderThreadPreview,h=a.renderThreadView,j=a.setPreviewThread,l=(k||(k=c("useReStore")))(),o=e.threadType,p=e.id;r([e]);d("Int64Hooks").useEffectInt64(function(){c("promiseDone")(l.runInTransaction(function(a){return c("LSVerifyThreadRowExistsStoredProcedure")(c("LSFactory")(a),{syncGroup:(i||(i=d("LSIntEnum"))).ofNumber(1),threadKey:p,threadType:o})},"readwrite"))},[l,p,o]);var q=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(l.table("threads")).getKeyRange(p)},[l,p],f.id+":198");n(function(){j(q)},[j,q]);if(q!=null)return m.jsx(s,{renderThreadPreview:g,renderThreadView:h,thread:q,children:b});else return null}t.displayName=t.name+" [from "+f.id+"]";function u(a,b,e){var g=(k||(k=c("useReStore")))(),h=(j||(j=d("I64"))).to_string(d("MWPActor.react").useActor()),i=d("ReQLSuspense").useArray(function(){return d("ReQL").fromTableAscending(g.table("participants")).filter(function(a){return b.has((j||(j=d("I64"))).to_string(a.contactId))}).map(function(a){return(j||(j=d("I64"))).to_string(a.threadKey)})},[g,b],f.id+":234");return d("ReQLSuspense").useFirst(function(){var c=new Set(i);return d("ReQL").fromTableAscending(g.table("threads")).filter(function(a){return(j||(j=d("I64"))).equal(a.threadType,e)}).filter(function(a){return a.threadName==null}).filter(function(a){a=a.clientThreadKey;if(a!=null)return c.has((j||(j=d("I64"))).to_string(a));else return!1}).filter(function(c){c=c.clientThreadKey;if(c==null)return!1;c=d("ReQLSuspense").toArray(d("ReQL").fromTableDescending(g.table("participants").index("threadKeyReadWatermarkTimestampMs")).getKeyRange(c).map(function(a){return(j||(j=d("I64"))).to_string(a.contactId)}).filter(function(a){return a!==h}),f.id+":269");if(p&&a.length===1&&c.length===0)return!0;else if(c.every(function(a){return b.has(a)}))return c.length===b.size;else return!1})},[i,g,e,a.length,h,b],f.id+":247")}function v(a,e,f,g){var l=(k||(k=c("useReStore")))();n(function(){a==null&&c("promiseDone")(l.runInTransaction(function(a){if((j||(j=d("I64"))).equal(e,(i||(i=d("LSIntEnum"))).ofNumber(2)))return c("LSLocalCreateOptimisticGroupThreadStoredProcedure")(c("LSFactory")(a),{checkExistingThreads:g,participants:c("LSVec").ofArray(f.map(function(a){return a.id}))}).then(function(){});else if(d("LSMessagingThreadTypeUtil").isSecure(e))return b("cr:7001")==null?(h||(h=b("Promise"))).resolve():b("cr:7001").call(a,f,e);c("recoverableViolation")("Don't know how to create optimistic thread for thread of thread type "+(e!=null?(j||(j=d("I64"))).to_string(e):""),"messenger_web_product");return(h||(h=b("Promise"))).resolve()},"readwrite"))},[g,l,JSON.stringify(a),JSON.stringify(e),f])}function w(a){var b=a.checkExistingThreads,c=a.children,d=a.renderThreadPreview,e=a.renderThreadView,f=a.setPreviewThread,g=a.threadType,h=a.tokenContactIdsMaybeExcludingActor,i=a.tokens;a=a.tokensMaybeExcludingActor;var j=u(a,h,g);r(a);v(j,g,i,b);n(function(){f(j)});if(j!=null)return m.jsx(s,{renderThreadPreview:d,renderThreadView:e,thread:j,children:c});else return null}w.displayName=w.name+" [from "+f.id+"]";function x(a,b,e,g){var h=(k||(k=c("useReStore")))(),l=(j||(j=d("I64"))).to_string(d("MWPActor.react").useActor()),m=d("ReQLSuspense").useArray(function(){return d("ReQL").fromTableAscending(h.table("participants")).filter(function(a){return b.has((j||(j=d("I64"))).to_string(a.contactId))}).map(function(a){return(j||(j=d("I64"))).to_string(a.threadKey)})},[h,b],f.id+":412");return d("ReQLSuspense").useFirst(function(){var a=new Set(m);return d("ReQL").fromTableAscending(h.table("threads")).filter(function(a){return(j||(j=d("I64"))).equal(a.threadType,e)}).filter(function(a){return a.threadName==null}).filter(function(a){if(g)return!0;else return(j||(j=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC))}).filter(function(b){return a.has((j||(j=d("I64"))).to_string(b.threadKey))}).filter(function(a){a=d("ReQLSuspense").toArray(d("ReQL").fromTableDescending(h.table("participants").index("threadKeyReadWatermarkTimestampMs")).getKeyRange(a.threadKey).map(function(a){return(j||(j=d("I64"))).to_string(a.contactId)}),f.id+":444");var c=a.filter(function(a){return a!==l});if(p&&c.length===0&&a.length===1)return!0;else if(a.length===c.length||c.length!==b.size)return!1;else return c.every(function(a){return b.has(a)})})},[m,h,JSON.stringify(e),g,a,b,l],f.id+":423")}function y(a){var b=a.checkExistingThreads,c=a.children,e=a.renderThreadPreview,f=a.renderThreadView,g=a.setPreviewThread,h=a.threadType,i=a.tokens,k=a.tokensMaybeExcludingActor;a=o(function(){return new Set(k.map(function(a){return(j||(j=d("I64"))).to_string(a.id)}))},[k]);var l=x(k,a,h,b);n(function(){l!=null&&g(l)},[g,l]);if(l!=null)return m.jsx(s,{renderThreadPreview:e,renderThreadView:f,thread:l,children:c});else return m.jsx(w,{checkExistingThreads:b,renderThreadPreview:e,renderThreadView:f,setPreviewThread:g,threadType:h,tokenContactIdsMaybeExcludingActor:a,tokens:i,tokensMaybeExcludingActor:k,children:c})}y.displayName=y.name+" [from "+f.id+"]";function a(a){var b=a.areWeCreatingASecureThread,e=a.checkExistingThreads;e=e===void 0?!0:e;var f=a.children,g=a.isCutoverInProgress;g=g===void 0?!1:g;var h=a.nullstate;h=h===void 0?null:h;var k=a.renderThreadPreview,l=a.renderThreadView,q=a.setPreviewThread,r=a.tokens,s=d("MWPActor.react").useActor();a=o(function(){return r.filter(function(a){return!(j||(j=d("I64"))).equal(a.id,s)})},[r,s]);n(function(){r.length===0&&q()},[q,r]);if(g)return m.jsx("div",{className:"x6s0dn4 x78zum5 x1iyjqo2 xl56j7k",children:m.jsx(c("MWXSpinner.react"),{color:"disabled",size:24})});if(r.length===0)return h;g=a.length;if(g!==1){if(g===0)return b?p?m.jsx(y,{checkExistingThreads:e,renderThreadPreview:k,renderThreadView:l,setPreviewThread:q,threadType:(i||(i=d("LSIntEnum"))).ofNumber(15),tokens:r,tokensMaybeExcludingActor:r,children:f}):h:m.jsx(t,{recipientToken:r[0],renderThreadPreview:k,renderThreadView:l,setPreviewThread:q,children:f})}else{g=a[0];if(e)if(b)return m.jsx(y,{checkExistingThreads:e,renderThreadPreview:k,renderThreadView:l,setPreviewThread:q,threadType:(i||(i=d("LSIntEnum"))).ofNumber(15),tokens:r,tokensMaybeExcludingActor:a,children:f});else return m.jsx(t,{recipientToken:g,renderThreadPreview:k,renderThreadView:l,setPreviewThread:q,children:f})}return m.jsx(y,{checkExistingThreads:e,renderThreadPreview:k,renderThreadView:l,setPreviewThread:q,threadType:b?(i||(i=d("LSIntEnum"))).ofNumber(16):(i||(i=d("LSIntEnum"))).ofNumber(2),tokens:r,tokensMaybeExcludingActor:a,children:f})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);